BLAST Step
Identifying pks and pks/nrps clusters harboring a potential self-resistance
gene.

********************************************************************************
STEP1. Blast 8 KSs against 11 databases
********************************************************************************

Location: TargetMining/Blast/ folder

Blast 8 diverse KSs from modular KS, cisat pks/nrps and transat pks/nrps hybrids
against 11 databases (wgs not updated)
and parse blast results with e value < 1

199 894 proteins;  110174 NCBI nucleotide records/genomes 

    The blast queries are in Manual/

    1. Make phylogenetic tree of all typeI ks sequences used to make HMMs (27)
    2. make a phylogenetic tree in clustal omega
    3. pick diverse sequences to Blast
    4. update 11 databases (wgs not updated since 2013)
       cd /mnt/gnpn/gnpn/projects/orphanpks/blast/db/
       perl update_blastdb.pl --passive [database]

1. Run ./run_blast.py (specify on line 49 which query sequences to blast against)
If you want to run blast agains all sequences, type
blast_query_files = glob.glob("%s/*.seq" % blast_query_dir)

2. Run make all

    All files stored in TargetMining/Blast/blast_results_seqs/ folder

    2.1 Concatenate all parsed blast files into one: make concat
    creates blast_results_seqs/blast_results.parsed.KS.9f

    2.2 Uniqify the proteins and remove dashes and asterisks and choose longest
    synonym: make longest (have to rm output files of Step #2.4)
    creates blast_results.parsed.KS.9f.synonyms
            blast_results.parsed.KS.9f.longest_synonym

    2.3. Compare the Reference set to the found set: make compare
    creates blast_results.parsed.KS.9f.longest_synonym.comparemibig

    2.4.  Make fasta file of blast hit sequences to use in HMM search and clean the
    names: make fasta
    creates blast_results.KS.fasta
            blast_results.KS.fasta.cleanName

    2.5. Remove redundant sequences (cdhit cutoff = 0.99): make cdhit
    creates blast_results.KS.fasta.cleanName.cdhit.99
            blast_results.KS.fasta.cleanName.cdhit.99.clstr

********************************************************************************
STEP2. Fetch all genbank ids that contain a KS
********************************************************************************

1. make Genbank dir:
 mkdir GenBank
 mkdir Genbank/gbdir
 cp get_gbids.py from oldTargetMining
 cp fetch_gbids.py from oldTargetMining

2. Run ./get_gbid.py > gbids.txt

    cat gbids.txt |wc
    162984  162984 1918063

    cat gbids.txt |sort -u > gbids.unique.94516.txt
    cat gbids.unique.94516.txt |wc
    94516   94516 1141060

3. Run fetch_gbid.py
    Genbank/gbdir$ lr |wc
    94517  850646 6623003

********************************************************************************
STEP3. Run Antismash on all 95k genbank ids
********************************************************************************

       Antismash_gbids/
       Run run_antismash.Agbids.py


Step 1: BLAST search for KS homologs.
Using 8 diverse KS query sequences, e-value < 1
199 894 proteins;  110174 NCBI nucleotide records/genomes

Step 2: Fetch all genbank ids that contain a KS
       Genbank/gbdir (89449 gbids)
       Genbank/assembly_gb (21080 gbids)

STEP3. Run Antismash on all 89k genbank ids and 21k assembly ids
	Some assembly gb files split into smaller files (26575 assembly files total)

STEP4. Extract gene sequences from all pks clusters found by antismash
    cluster_genes.21k.fasta
    KS.21k.fasta
    cluster_genes.89k.fasta
    KS.89k.fasta
78 clusters don’t have predicted KS domains (details_data empty)

STEP5. Make blast database from cluster_genes.21k.fasta and cluster_genes.89k.fasta
244 196 sequences
664 336 sequences

STEP6. Blast 12 targets genes against antismash database from 110k genbank ids
4404 hits.

STEP7. Filter blast hits by evalue <1e-8 and identity > 0.3 (and FabB/F identity > 0.6)
806 hits.

STEP8. Require both KS+ target <10kb apart.
252 hits.
________________________________________________________________________________
Mine 92 putative targets, start from Step6:

STEP6. Blast 92 targets genes against antismash database from 110k genbank ids

        6.1. ./run_blastp.py with targets.92.fa
        6.2. cat out.targets.85* > out.92

31944 hits.

STEP7. Filter blast hits by evalue <1e-8 and identity > 0.3 (and FabB/F identity > 0.6)
82015 hits.

STEP8. Require both KS+ target <5kb apart.
      ./target_ks_tandem.py > KS.92.5kb.fasta
      ./target_ks_tandem.py > KS.92.5kb.fasta
      ./target_ks_tandem.py > target_ks_tandem.92.5kb.out
1639 hits.

252/4404 = 0.057
1639/31944 = 0.051
Similar discovery rate

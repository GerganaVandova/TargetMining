Useful commands:
diskutil umount force /Users/gvandova/oldTargetMining/
sshfs gvandova@maguro.stanford.edu:/mnt/gnpn/gnpn/projects/orphanpks/oldTargetMining/ /Users/gvandova/oldTargetMining/


April 25, 2018

1. Update blast databases
    ssh maguro
    cd /mnt/gnpn/gnpn/projects/orphanpks/blast/db/
    screen
    perl update_blastdb.pl --passive refseq_genomic                 yes
    perl update_blastdb.pl --passive nt                             yes
    perl update_blastdb.pl --passive other_genomic                  yes
    perl update_blastdb.pl --passive env_nt                         yes
    perl update_blastdb.pl --passive patnt                          yes
    perl update_blastdb.pl --passive sts                            yes
    perl update_blastdb.pl --passive htgs                           yes
    perl update_blastdb.pl --passive tsa_nt                         yes
    perl update_blastdb.pl --passive wgs                            NOT FOUND?
    perl update_blastdb.pl --passive gss                            yes

Add one more:
    perl update_blastdb.pl --passive est_others

Unzip db
for f in `ls wgs.9*.tar.gz`; do echo "----------    $f    -----------"; tar -xvzf $f; done

Blast FTP site
https://www.ncbi.nlm.nih.gov/books/NBK62345/

The EST database is a collection of short single-read transcript sequences from GenBank. These sequences provide a resource to evaluate gene expression, find potential variation, and annotate genes.
https://www.ncbi.nlm.nih.gov/genbank/htgs/
https://www.ncbi.nlm.nih.gov/dbSTS/
other_genomic -  Genomic records (NC/NT/NS/NZ accessioned) for lower eukaryotes, microbes and organelles.
refseq_genomic.##.tar.gz	All genomic sequences from NCBI RefSeq project, including wgs scaffolds.


April 26, 2018
2. Unzip databases:
for f in `ls *.tar.gz`; do echo "----------    $f    -----------"; tar -xvzf $f; done

3a. Get WGS database:
Whole genome shotgun sequence assemblies for various organisms. It is already
superseded by the project-based datasets stored in vdb format (ftp://ftpâ€‹.ncbi.nlm.nih.gov/sra/wgs/).

3b. Download Assemblies (is this the same as WGS data?):

    https://www.ncbi.nlm.nih.gov/genome/doc/ftpfaq/


    https://www.ncbi.nlm.nih.gov/assembly/?term=all%5Bfilter%5D
    filter by bacteria (137,085 entries)

    This is the ftp site:
    https://ftp.ncbi.nlm.nih.gov/genomes/genbank/bacteria/Acetobacter_cerevisiae/all_assembly_versions/GCA_001580535.1_ASM158053v1/GCA_001580535.1_ASM158053v1_genomic.gbff.gz
    https://ftp.ncbi.nlm.nih.gov/genomes/genbank/bacteria/*/all_assembly_versions/*/*.gbff.gz

    This is the command:
    https://ftp.ncbi.nlm.nih.gov/genomes/genbank/bacteria/Acetobacter_cerevisiae/all_assembly_versions/GCA_001580535.1_ASM158053v1/GCA_001580535.1_ASM158053v1_genomic.gbff.gz

    This is the modified command I should try:
    wget https://ftp.ncbi.nlm.nih.gov/genomes/genbank/bacteria/*/all_assembly_versions*/*.gbff.gz -P my_dir/

Ask John Bell for help- he doesn't know how to help

4. Choose clusters to mine:
    1. TypeI Modular PKS
    2. Trans AT PKS
    3. NRPS
    4. PKS/NRPS Hybrid
    5. Bacterial type III PKS
    6. TypeI Iterative PKS
    7. TypeII PKS

5. Choose sequences from each class to mine:

    1. TypeI Modular PKS

        All of the pks/nrps hybrids are with at least 3 KS,
        TODO: Should I add nrps/pks hybrdids?
    2. trans-AT pks/nrps hybrids (7 sequences)
    3. Cis-AT pks/nrps hybrids (10 sequences)


        From Maureen's 2014 phylogenetic tree, choose 11 typeI pks, and all pks/nrps

        trans-at pks nrps hybrids
        Pederin (AX768043 1) 2003, 10 KS, 2 AT, 2 C, 2 A, Pseudomonas sp.
        Rhizoxin (AM411073 1) 2006, 16 KS, 2 AT, 2 C, 1 A, Burkholderia rhizoxina           pks in pksdb
        Difficidin (AJ634062 1) 2004, 14 KS, 1 AT, 0 C, 1 A, Bacillus amyloliquefaciens
        Bryostatin (DQ889941 1) 2004, 16 KS, AT, 1 C, 0 A, Candidatus Endobugula sertula    pks in both db
        Mupirocin (AF318063S1 1) 2000, 10 KS, 2 AT, 0 C, 0 A, Pseudomonas fluorescens       pks in both db
        Leinamycin (AF484556 1) 2002, 7 KS, 1 AT, 7 C, 7 A, Streptomyces atroolivaceus
        Chivosazol (DQ065771 1) 2005, 18 KS, 2 AT, 2 C, 1 A, Polyangium cellulosum          pks in pksdb
        Disorazol (AJ874112 1) 2004, 10 KS, 1 AT, 2 C, 1 A, Polyangium cellulosum           pks in pksdb
        Virginiamycin (AB283030 1) 2006, 8 KS, 1 AT, 6 C, 4 A, Streptomyces virginiae       pks in pksdb
        Pristinamycin (FR682001 1) 2010, 10 KS, 1 AT, 3 C, 3 A, Streptomyces pristinaespiralis  nrps pksdb, pks/nrps in mibig, but no KS domains, exclude
        Lankacidin (GQ925917 1) 2009, 5 KS, 1 AT, 1 C, 1 A, Streptomyces rochei


        Cis-AT ps/nrps hybrids
        Myxothiazol (AF188287 1) 1999, 5 KS, 6 AT, 3 C, 3 A, Stigmatella aurantiaca
        Melithiazol (AJ557546 1) 2003, 4 KS, 4 AT, 3 C, 3 A, Melittangium lichenicola
        Curacin (AY652953 1) 2010, 9 KS, 9 AT, 1 C, 1 A, Lyngbya majuscula
        Guadinomine (JX545234 1) 2012, 4 KS, 4 AT, 1 C, 1 A, Streptomyces sp. K01-0509
        Cylindrospermopsin (EU140798 1) 2007, 5 KS, 5 AT, 0 C, 1 A, Cylindrospermopsis raciborskii
        Epothilone (AF210843 1) 1999, 9 KS, 9 AT, 1 C, 1 A, Sorangium cellulosum
        Chondramide (AM179409 1) 2005, 3 KS, 4 AT, 3 C, 3 A, Chondromyces crocatus      in pksdb as modular pks
        Microcystin (AF183408 1) 1999, 4 KS, 3 AT, 6 C, 7 A, Microcystis aeruginosa
        Cryptophycin (EF159954 1) 2006, 3 KS, 3 AT, 3 C, 3 A, Nostoc sp. ATCC 53789     in pksdb as modular pks
        Pyoluteorin (CP000076 2) 1998, 3 KS, 2 AT, 0 C, 1 A, Pseudomonas protegens      ib both pksdb and mibig as pks, exclude

        add rapamycin, why it is not in her tree?



April 30, 2018

    4. iterative type I pks
        Most itypeI are from fungal plant pathogens
        There are 3 bacterial KS sequences in pksdb.
        I should probably skip this class

    5. type II pks (12 sequences) - from the pnas paper


II. pHMM_train STEP
gvandova@maguro:/mnt/gnpn/gnpn/projects/orphanpks/TargetMining/pHMM_train/pHMM_train/FASTA$

                 1. rm all files but t2ks.selectKnown12.fasta
                                  t2ks.antismash.Erin.60.fasta
                                  KSIII.10.fasta

                 gvandova@maguro:/mnt/gnpn/gnpn/projects/orphanpks/TargetMining/pHMM_train/pHMM_train/FASTA$ lr
                 total 48
                 -rw-r----- 1 gvandova orphanpks 29203 Apr 30 11:39 t2ks.antismash.Erin.60.fasta
                 -rw-rw-r-- 1 gvandova orphanpks  4392 Apr 30 11:39 KSIII.10.fasta
                 -rw-rw-r-- 1 gvandova orphanpks  5867 Apr 30 11:39 t2ks.selectKnown12.fasta

                 2. add all typeI ks sequences to FASTA/
                 gvandova@maguro:/mnt/gnpn/gnpn/projects/orphanpks/TargetMining/pHMM_train$ mv *.fasta pHMM_train/FASTA/


                 3. MSA and HMM

                 muscle -in t1ks.11.fasta -out t1ks.11.fas -maxiters 100
                 muscle -in t2ks.12.fasta -out t2ks.12.fas -maxiters 100
                 muscle -in cisatpksnrps.10.fasta -out cisatpksnrps.10.fas -maxiters 100
                 muscle -in transatpksnrps.7.fasta -out transatpksnrps.7.fas -maxiters 100

                 hmmbuild -n t1ks --amino t1ks.11.hmm t1ks.11.fas
                 hmmbuild -n t2ks --amino t2ks.12.hmm t2ks.12.fas
                 hmmbuild -n cisat--amino cisatpksnrps.10.hmm cisatpksnrps.10.fas
                 hmmbuild -n transat --amino transatpksnrps.7.hmm transatpksnrps.7.fas

                 mv *.fas ../MSA/
                 mv FASTA/*.hmm HMM/

                 4. Compare 4 pHMMs interms of how they score:


                    Compile Training sets in FastaTestSets:

                    TypeII.KS.30.fasta (from typeII paper)
                    TypeIII.KS.3.fasta (from typeII paper)
                    KSIII.10.fasta (from typeII paper)
                    FabF.fasta (from typeII papper)
                    TypeI.KS.5.fasta (choose 5 diff from Maureen's typeI paper)
                    TypeI.KS.pksdb.516.fasta (all cis typeI from pksdb)
                    Transat.KS.5.fasta (from pksdb, 2 PKS and 3 PKS/NRPS)
                    Cisat.KS.5.fasta (from pksdb, 2 NRPS/PKS and 3 PKS/NRPS)

                5. Run make hmmsearch (no changes in Makefile)
                    creates HMM.hmmsearch.FastaTestSets/
                    HMM.hmmsearch.FastaTestSets.parse/


                6. run selectCutoff.R

                type I.516 from pksdb indistinguishable from cisAT pks

                most of the bottom ones are KS1, there are also some pks/nrps hybrids in this set
                might be able to select a cutoff to distingush between typeI pks and transatpks, but not
                between typeI pks and cisat pks



Blast

1. Make phylogenetic tree of all typeI ks sequences used to make HMMs (27)
2. make a phylogenetic tree in clustal omega
3. pick diverse sequences to Blast

grep -lr "leinamycin" *     transatpksnrps.7.fasta
grep -lr "KSdisorazol " *   transatpksnrps.7.fasta
grep -lr "KScuracin" *      cisatpksnrps.10.fasta
grep -lr "KSepothilone" *   cisatpksnrps.10.fasta
grep -lr "KSchivosazol" *   transatpksnrps.7.fasta
grep -lr "KSguadinomine" *  cisatpksnrps.10.fasta
grep -lr "eryth" *          t1ks.10.fasta
grep -lr "KSrapamycin" *    cisatpksnrps.10.fasta


May 3, 2018
1. Cannot download the Assemblies. Run out of disk space. Downoaded 290G.
    Sequences are ordered by number, so I cannot search them by name.

    gvandova@maguro:/mnt/gnpn/gnpn/projects/orphanpks/TargetMining/Assemblies$ find -type f -name '*.gz'  | wc -l
    132240
    gvandova@maguro:/mnt/gnpn/gnpn/projects/orphanpks/TargetMining/Assemblies$ du -sh .
    290G	.


    gvandova@maguro:/mnt/gnpn/gnpn/projects/orphanpks/oldTargetMiningGenome$ du -sh *
    2.0G    antismash
    228G    antismash_output_refseq
    35G     gbdirs
    112G    gbdirs_all
    9.5K    parse_gb.py
    9.5K    parse_js.py
    93G     refseq_bacterial_genomes
    52G     refseq_bacterial_genomes_gz
    512     refseq_parsed_clusters
    9.5K    run_antismash_genomes.py
    1.8G    test_antismash_output_refseq
    192M    test_refseq_bacterial_genomes

    TODO: Delete antismash_output_refseq
           refseq_bacterial_genomes
           refseq_bacterial_genomes_gz

2. Make pHMM from all typeI sequences but the 8 used for Blast step

2.1 Make fasta file
    cp t1ks.27.fasta t1ks.19.fasta
    manually remove the 8
    check:
    TargetMining/pHMM_train/FASTA$ cat t1ks.19.fasta | grep ">"|wc
         19     166    1467
2.2. Make MSA
    muscle -in t1ks.19.fasta -out ../MSA/t1ks.19.fas -maxiters 100

2.3 Make HMM
    hmmbuild -n t1ks19 --amino ../HMM/t1ks.19.hmm ../MSA/t1ks.19.fas

Remove HMM.hmmsearch.FastaTestSets/ and HMM.hmmsearch.FastaTestSets.parse/

3. Run make hmmsearch (no changes in Makefile)
  the script crashes because of TypeI.KS.pksdb.516.fasta test set?

  May 7th 2018 
  move TypeI.KS.pksdb.516.fasta to FastaTestSets_unused and rerun Makefile
  no errors this time
  commit




1. Esearch to find id of species/class:
    esearch -db taxonomy -query "Streptomyces" | esummary -db taxonomy | xtract -pattern DocumentSummary -element Id

    1883

/home/gvandova/taxid2wgs.pl 1883 -alias_file streptomyces_wgs -title "streptomyces wgs"
gvandova@maguro:/mnt/gnpn/gnpn/projects/orphanpks/TargetMining$
sratoolkit.2.9.0-ubuntu64/bin/blastn_vdb -db streptomyces_wgs -query Blast/Manual/KScuracin.seq -evalue 0.001 -out blast_out_streptomyces -num_threads 64



esearch -db taxonomy -query "spiders" | esummary -db taxonomy | xtract -pattern DocumentSummary -element Id
6893
/home/gvandova/taxid2wgs.pl 6893 -alias_file spiders_wgs -title "spiders wgs"
sratoolkit.2.9.0-ubuntu64/bin/blastn_vdb -db spiders_wgs -query Blast/Manual/KScuracin.seq -evalue 1 -out blast_out_spiders -num_threads 64


gvandova@maguro:~/ncbi/public$ du -s wgs
19350316

gvandova@maguro:~/ncbi/public$ du -sh wgs
19G	wgs
